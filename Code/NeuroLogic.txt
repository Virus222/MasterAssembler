# это первая обучаемая версия нейросети, которая НЕ СОХРАНЯЕТ ДАННЫЕ ОБУЧЕНИЯ, но уже умеет выдавать шаблонную сборку, учитывая тип пк
# дата выхода - 18.12.2025

import torch
import torch.nn as nn  # инструменты для создания нейросети
import torch.optim as optim  # модуль оптимизаторов
import difflib

non_pc_texts = [
    line.strip()
    for line in open("text_not_pc.txt", encoding="utf-8")
]

game_texts = [  # про игровой пк
    line.strip()
    for line in open('game_pc_with.txt', encoding="utf-8")
]

office_texts = [  # про офисный пк
    line.strip()
    for line in open('office_pc_with.txt', encoding="utf-8")
]

labels = (
        [0] * len(non_pc_texts) +
        [1] * len(game_texts) +
        [2] * len(office_texts)
)

texts = non_pc_texts + game_texts + office_texts  # сумма массивов
words = set()  # Блок создания словаря

for t in texts:  # перебор слов в предложении
    for w in t.split():
        words.add(w)

word2idx = {w: i for i, w in enumerate(words)}  # создание таблицы с индексами слов
vocab_size = len(words)  # подсчёт слов в словаре

def find_similar(word, vocabulary, cutoff=0.6): # защита от ошибок пользователя
    matches = difflib.get_close_matches(word, vocabulary, n=1, cutoff=cutoff)
    return matches[0] if matches else None

def text_to_vec(text):  # превращение текста в вектор признаков, который нейросеть принимает
    vec = torch.zeros(vocab_size)

    for w in text.lower().split():
        if w in word2idx:
            vec[word2idx[w]] = 1
        else:
            similar = find_similar(w, word2idx.keys())
            if similar:
                vec[word2idx[similar]] = 1
    return vec

class PCClassifier(nn.Module):  # создание класса нейросети
    def __init__(self, input_size):
        super().__init__()  # регистрация модели в пайторч
        self.layer = nn.Linear(input_size, 3)  # создание линейного слоя (трёх нейронов :0)

    def forward(self, x):  # предоставление вычислительного графа
        return self.layer(x)

data = torch.stack([text_to_vec(t) for t in texts])  # создание матрицы признаков
targets = torch.tensor(labels)

model = PCClassifier(vocab_size)
loss_fn = nn.CrossEntropyLoss()
optim = optim.SGD(model.parameters(), lr=0.1)

print('Начинаем обучение...')

for epoch in range(3001): # блок обучения
    logits = model(data)
    loss = loss_fn(logits, targets)

    optim.zero_grad()
    loss.backward()
    optim.step()

    if epoch % 1000 == 0:
        print(f'{(str(epoch/3000)[:4])}')

office_pc_base_config = {
    'Корпус': 'Стандартный ATX корпус',
    "Материнская плата": "B660",
    "Процессор": "Intel Core i5-12400",
    "Охлаждение на процессор": "Комплектный кулер к процессору",
    "Вывод изображения": "Встроенная графика Intel",
    "Оперативная память": "16 ГБ DDR4",
    "Накопитель": "1 ТБ SSD",
    "Блок питания": "500W с сертификатом 80+ Bronze"
} # стандартная офисная сборка

game_pc_base_config = {
    'Корпус': 'ATX корпус с хорошей вентиляцией',
    "Материнская плата": "B760",
    "Процессор": "Intel Core i5-13400F",
    "Охлаждение на процессор": "Башенный кулер, теплоотводом > 150 ват",
    "Видеокарта": "NVIDIA GeForce RTX 4060",
    "Оперативная память": "16 ГБ DDR5",
    "Накопитель": "1 ТБ SSD",
    "Блок питания": "650W с сертификатом 80+ Bronze"
} # стандартная игровая сборка

def build_pc(type): # логика выводит сборку
    if type == 1:
        for part, value in game_pc_base_config.items():
            print(f'{part}: {value}')
    elif type == 2:
        for part, value in office_pc_base_config.items():
            print(f'{part}: {value}')

def analyze_text(text):
    vec = text_to_vec(text)

    with torch.no_grad():
        logits = model(vec)
        cls = torch.argmax(logits).item()

    if cls == 0:
        return 0, 'Вы задали вопрос не по теме или я не распознал запрос. Попробуйте задать его снова'
    elif cls == 1:
        return 1, 'Вижу, что вы хотите игровой пк. Могу предложить вам компьютер со следующими характеристиками:'
    else:
        return 2, 'Вижу, что вы хотите офисный пк. Могу предложить вам компьютер со следующими характеристиками:'

print('остановить нейросеть можно командой -- стоп')

while True:
    print('Введите запрос')

    req = input().lower()

    if req == 'стоп':
        print('завершение работы...')
        break

    cls, message = analyze_text(req)
    print(message)

    if cls in (1, 2):
        build_pc(cls)